<html>
<head>
<link rel=StyleSheet href="../../pdbstyle.css" type="text/css" media=all>
<title>Rotate about an arbitrary axis (3 dimensions)</title>
</head>
<body>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script language="JavaScript">
<!--
   if (self.location.href != top.location.href) {
      top.location.href = self.location.href;
   }
-->
</script>


<center><table width=800><tr><td>

<table width=100%><tr><td>
<center>
<h1>Rotate a point<br>about an arbitrary axis<br>(3 dimensions)</h1>
Written by <a href="../index.html">Paul Bourke</a><br>
December 1992, Updated August 2002
<p align="justify">
Illustrative C code that implements the following algorithm is
<a href="example.c">given here</a>.
A closed solution attributed to Ronald Goldman is presented as this
<a href="source.c">C function</a>. 
A contribution by Bruce Vaughan in the form of a Python script
for the SDS/2 design software: <a href="PointRotate.py">PointRotate.py</a>.
</p>
</center>
<p><br><p>
</td><td valign="top" align="right" width=250>
<img src="rotate1.gif" width="200" height="207">
</td></tr></table><p>

Rotation of a point in 3 dimensional space by theta 
about an arbitrary axes defined by a line between
two points P<sub>1</sub> = 
(x<sub>1</sub>,y<sub>1</sub>,z<sub>1</sub>) and P<sub>2</sub>  =
(x<sub>2</sub>,y<sub>2</sub>,z<sub>2</sub>) can be achieved by
the following steps<p>
<ul>
(<b>1</b>) translate space so that the rotation axis passes through the
origin<p>
(<b>2</b>) rotate space about the x axis so that the rotation axis lies in the
xz plane<p>
(<b>3</b>) rotate space about the y axis so that the rotation axis lies along
the z axis<p>
(<b>4</b>) perform the desired rotation by theta about the z axis<p>
(<b>5</b>) apply the inverse of step (<b>3</b>)<p>
(<b>6</b>) apply the inverse of step (<b>2</b>)<p>
(<b>7</b>) apply the inverse of step (<b>1</b>)<p>
</ul>
<p>

<b>Note</b>:
<ul>
<li><p align="justify">
If the rotation axis is already aligned with the z axis then
steps <b>2</b>, <b>3</b>, <b>5</b>, and <b>6</b> need not be performed. 
</p>
<li><p align="justify">In all that follows
a right hand coordinate system is assumed and rotations are positive
when looking down the rotation axis towards the origin.
</p>
<li><p align="justify">
Symbols representing matrices will be shown in bold text.
</p>
<li><p align="justify"> 
The inverse of the rotation matrices below are particularly
straightforward since the determinant is unity in each case.
</p>
<li><p align="justify">
All rotation angles are considered positive if anticlockwise looking
down the rotation axis towards the origin.
</p>
</ul>
<p>

<b>Step 1</b><br>
<p align="justify">
Translate space so that the rotation axis passes through the origin.
This is accomplished by translating space by
-<b>P</b><sub>1</sub> (-x<sub>1</sub>,-y<sub>1</sub>,-z<sub>1</sub>). 
The translation matrix <b>T</b> and the inverse <b>T</b><sup>-1</sup> 
(required for step 7) are given below
</p>

<center><table><tr><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>T</b> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>1</td> <td>0</td> <td>0</td> <td>-x<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>1</td> <td>0</td> <td>-y<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>0</td> <td>1</td> <td>-z<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>0</td> <td>0</td> <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td><td width=40>
&nbsp;
</td><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>T</b><sup>-1</sup> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>1</td> <td>0</td> <td>0</td> <td>x<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>1</td> <td>0</td> <td>y<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>0</td> <td>1</td> <td>z<sub>1</sub></td> </tr>
<tr> <td>0</td> <td>0</td> <td>0</td> <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td></tr></table></center><p>

<b>Step 2</b><br>
<p align="justify">
Rotate space about the x axis so that the rotation axis lies in the xz plane.
Let U = (a,b,c) be the unit vector along the rotation axis.
and define d = sqrt(b<sup>2</sup> + c<sup>2</sup>) 
as the length of the projection onto the yz plane.
If d = 0 then the rotation axis is along the x axis and no 
additional rotation is necessary. 
Otherwise rotate the rotation axis so that is lies in the xz plane.
The rotation angle to achieve this
is the angle between the projection of rotation axis in
the yz plane and the z axis. This can be calculated from the dot product of the
z component of the unit vector U and its yz projection.
The sine of the angle is determine by considering the cross product.
</p>

<center><table><tr><td>

<center>
<table cellspacing=0 cellpadding=0 border=0>
<tr>
<td>&nbsp;</td>
<td align="center">(0,0,c) dot (0,b,c)</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>cos(t) = </td>
<td><hr></td>
<td> = c/d</td>
</tr>
<tr>
<td>&nbsp;</td>
<td align="center">c d</td>
<td>&nbsp;</td>
</tr>
</table>
</center>

</td><td width=40>
&nbsp;
</td><td>

<center>
<table cellspacing=0 cellpadding=0 border=0>
<tr>
<td>&nbsp;</td>
<td align="center">|| (0,0,c) cross (0,b,c) ||</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>sin(t) = </td>
<td><hr></td>
<td> = b/d</td>
</tr>
<tr>
<td>&nbsp;</td>
<td align="center">c d</td>
<td>&nbsp;</td>
</tr>
</table>
</center>

</td></tr></table></center><p>

<p align="justify">
The rotation matrix <b>R</b><sub>x</sub> and the inverse 
<b>R</b><sub>x</sub><sup>-1</sup> (required for step 6) are given below
</p>

<center><table><tr><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>R</b><sub>x</sub> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>1</td> <td>0</td> <td>0</td> <td>0</td> </tr>
<tr> <td>0</td> <td>c/d</td> <td>-b/d</td> <td>0</td> </tr>
<tr> <td>0</td> <td>b/d</td> <td>c/d</td> <td>0</td> </tr>
<tr> <td>0</td> <td>0</td> <td>0</td> <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td><td width=40>
&nbsp;
</td><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>R</b><sub>x</sub><sup>-1</sup> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>1</td> <td>0</td>    <td>0</td>   <td>0</td> </tr>
<tr> <td>0</td> <td>c/d</td>  <td>b/d</td> <td>0</td> </tr>
<tr> <td>0</td> <td>-b/d</td> <td>c/d</td> <td>0</td> </tr>
<tr> <td>0</td> <td>0</td>    <td>0</td>   <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td></tr></table></center><p>

<b>Step 3</b><br>
<p align="justfy">
Rotate space about the y axis so that the rotation axis lies along the
positive z axis.
Using the appropriate dot and cross product relationships as before the cosine
of the angle is d, the sine of the angle is a.
The rotation matrix about the y axis <b>R</b><sub>y</sub>
and the inverse <b>R</b><sub>y</sub><sup>-1</sup> 
(required for step 5) are given below.
</p>

<center><table><tr><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>R</b><sub>y</sub> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>d</td> <td>0</td>  <td>-a</td> <td>0</td> </tr>
<tr> <td>0</td> <td>1</td>  <td>0</td>  <td>0</td> </tr>
<tr> <td>a</td> <td>0</td>  <td>d</td>  <td>0</td> </tr>
<tr> <td>0</td> <td>0</td>  <td>0</td>  <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td><td width=40>
&nbsp;
</td><td>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>R</b><sub>y</sub><sup>-1</sup> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>d</td> <td>0</td>  <td>a</td> <td>0</td> </tr>
<tr> <td>0</td> <td>1</td>  <td>0</td>  <td>0</td> </tr>
<tr> <td>-a</td> <td>0</td>  <td>d</td>  <td>0</td> </tr>
<tr> <td>0</td> <td>0</td>  <td>0</td>  <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>

</td></tr></table></center><p>

<b>Step 4</b><br>
<p align="justify">
Rotation about the z axis by t (theta) is <b>R</b><sub>z</sub> and is
simply
</p>

<center>
<table cellpadding=0 cellspacing=0 border=0><tr>
<td><b>R</b><sub>z</sub> = </td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table cellpadding=4 cellspacing=2 border=0>
<tr> <td>cos(t)</td>  <td>-sin(t)</td>  <td>0</td>  <td>0</td> </tr>
<tr> <td>sin(t)</td> <td>cos(t)</td>  <td>0</td>  <td>0</td> </tr>
<tr> <td>0</td>       <td>0</td>       <td>1</td>  <td>0</td> </tr>
<tr> <td>0</td>       <td>0</td>       <td>0</td>  <td>1</td> </tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>
<p>

<p align="justify">
The complete transformation to rotate a point (x,y,z) about the rotation
axis to a new point (x`,y`,z`) is as follows, the forward transforms
followed by the reverse transforms.
</p>

<center>
<table><tr>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table>
<tr><td>x'</td></tr>
<tr><td>y'</td></tr>
<tr><td>z'</td></tr>
<tr><td>1</td></tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
<td> = </td>
<td>
<b>T</b><sup>-1</sup>
<b>R</b><sub>x</sub><sup>-1</sup>
<b>R</b><sub>y</sub><sup>-1</sup>
<b>R</b><sub>z</sub>
<b>R</b><sub>y</sub>
<b>R</b><sub>x</sub>
<b>T</b>
</td>
<td><img src="left.gif" width=13 height=122></td>
<td>
<table>
<tr><td>x</td></tr>
<tr><td>y</td></tr>
<tr><td>z</td></tr>
<tr><td>1</td></tr>
</table>
</td>
<td><img src="right.gif" width=13 height=122></td>
</tr></table>
</center>
<p>

<h3>Using quaternions</h3>
<p align="justify">
To rotate a 3D vector "p" by angle theta about a (unit) axis "r" one forms the
quaternion
</p>
<center>
Q<sub>1</sub> = (0,p<sub>x</sub>,p<sub>y</sub>,p<sub>z</sub>)
</center>
<p align="justify">
and the rotation quaternion
</p>
<center>
Q<sub>2</sub> = (cos(theta/2), r<sub>x</sub> sin(theta/2),
r<sub>y</sub> sin(theta/2), r<sub>z</sub> sin(theta/2)).
</center>
<p align="justify">
The rotated vector is the last three components of the quaternion
</p>
<center>
Q<sub>3</sub> = Q<sub>2</sub> Q<sub>1</sub> Q<sub>2</sub><sup>*</sup>
</center>
<p align="justify">
It is easy to see that rotation in the opposite direction (-theta) can be
achieved by reversing the order of the multiplication.
</p>
<center>
Q<sub>3</sub> = Q<sub>2</sub><sup>*</sup> Q<sub>1</sub> Q<sub>2</sub>
</center>
<p>
Note also that the quaternion Q<sub>2</sub> is of unit magnitude.
<p>

</td></tr></table></center>
</body>
</html>
