<html>
<head>
<link rel=StyleSheet href="../../pdbstyle.css" type="text/css" media=all>
<title>Registration for HDR image alignment</title>
</head>
<body>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script language="JavaScript">
<!--
   if (self.location.href != top.location.href) {
      top.location.href = self.location.href;
   }
-->
</script>


<center><table width=800><tr><td>

<h1>Registration for HDR image alignment</h1>
Written by <a href="../index.html">Paul Bourke</a><br>
April 2006
<p><br><p>

<b>Registration problem</b><p>
<center><table><tr><td valign="top">
<p align="justify">
This note discusses an approach for aligning multiple images by applying 
<a href="../index.html">planar
stretching</a> (warping) to each one based upon manually selected registration points.
The particular application demonstrated here is the alignment of multiple
panoramic images for high dynamic range imaging (HDR), these images were drum
scanned and so contained slight scaling, shear, and rotational errors.
</p>
<p align="justify">
The errors involved can be illustrated by taking two of the
panoramic images to be combined into a HDR image and aligning them
on the right hand side then (in this example pair) there is a rotation
and a scaling error for objects on the left hand side. This can be introduced by
film slippage in the image capture, stretching of the film, variation in
the drum scanning.
This obviously needs to be corrected if multiple images are to be combined
into a single HDR image.
</p>
</td><td width=10>
&nbsp;
</td><td>
<center>
<img src="http://paulbourke.net/miscellaneous/registration/offset.jpg" width=400 height=400 border=1>
</center>
</td></tr></table></center><p>

<b>Image registration</b><p>
<p align="justify">
In the following two images, the second is to be aligned to the first. Sharp features
are identified in the each image (blue guide lines in Photoshop), these form a polygon
(red lines). The pixel positions are recorded for each of the 4 points.
The second image is automatically warped so that the polygon in the second image
becomes aligned with the polygon in the first image. Before alignment features in the
second image were misaligned with respect to the first image by up to 50 pixels.
</p>
<center>
<img src="http://paulbourke.net/miscellaneous/registration/poly1.jpg" width=800 height=250 border=1><p>
<img src="http://paulbourke.net/miscellaneous/registration/poly2.jpg" width=800 height=250 border=1><p>
</center>
<p align="justify">
The result was registration of image features to at most a 2 pixel error (worst case)
over 10,000 pixel image width over the whole image frame.
Difference between images before and after the registration illustrated by subtracting
the two original images and the registered images..
Note that one doesn't expect total black because these are taken with different exposure
settings, the images were equalised before differencing to reduce this variation. The
important feature is the lack of outlines in the differenced image after the registration.
</p>
<center>
<img src="http://paulbourke.net/miscellaneous/registration/diff1.jpg" width=800 height=250 border=1><br>
</center>
Difference before registration<p>
<center>
<img src="http://paulbourke.net/miscellaneous/registration/diff2.jpg" width=800 height=250 border=1><br>
</center>
Difference after registration.<p>

<b>More extreme example: test case</b><p>
<center><table><tr><td>
	<img src="http://paulbourke.net/miscellaneous/registration/image1.jpg" width=400 height=300 border=1><br>First image.
</td><td width=10>
	&nbsp;
</td><td>
	<img src="http://paulbourke.net/miscellaneous/registration/image2.jpg" width=400 height=300 border=1><br>Second image.
</td></tr><tr><td>
	<img src="http://paulbourke.net/miscellaneous/registration/image3.jpg" width=400 height=300 border=1>
</td><td width=10>
	&nbsp;
</td><td valign="top">
	<p align="justify">
	Second image warped to align the registration regions shown as black border.
	The registration region in the first image need not be rectangular as shown in
	this example.
	Blue region is not defined, out of bounds in second image.
	Used standard supersampling antialiasing.
	</p>
</tr></table></center><p>

</td></tr></table></center>

</body>
</html>

