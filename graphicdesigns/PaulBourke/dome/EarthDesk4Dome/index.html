<html>
<head>
<link rel=StyleSheet href="../../pdbstyle.css" type="text/css" media=all>
<title>EarthDesk in a Dome</title>
</head>
<body>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script language="JavaScript">
<!--
   if (self.location.href != top.location.href) {
      top.location.href = self.location.href;
   }
-->
</script>



<center>
<h1>EarthDesk in a Dome</h1>
Written by <a href="../index.html">Paul Bourke</a><br>
July 2009, updated in April 2016<p>
<a href="http://paulbourke.net/dome/EarthDesk4Dome/EarthDesk4Dome.zip">Download Quartz Composer Composition (EarthDesk4Dome.zip)</a>
</center>
<p><br><p>

<center><table width=800><tr><td>

<p align="justify">
The following allows one to display current/live Earth images interactively
on a planetarium dome (or iDome) using either a fisheye projection system or
a spherical mirror based system. It uses EarthDesk to generate the spherical
projections, and Quartz Composer to manage the display. It is provided mainly
as a demonstration for those who may not have used Quartz Composer, an excellent
tool for interactive graphics.
</p>

<b>Quartz Composer</b>
<p align="justify">
Quartz Composer is supplied free of charge with the Apple XCode development 
systems (also free). You are encouraged to look through the Quartz Composer
patch in order to understand what is occurring. When you are ready to run
the composition you need to enter full screen mode.
</p>

<b>pbmesh</b>
<p align="justify">
"pbmesh" is a Quartz Composer patch that implements the image warping technique
used by the author to warp fisheye images for spherical mirror based projection
(although it has a much wider range of application).
pbmesh is also free, it needs to be copied into<br>
&nbsp;&nbsp;&nbsp;/Library/Graphics/Quartz Composer Patches
<br>
This must be exactly as shown above, it is NOT the same as a 
similar appearing directory called "Quartz Composer Plugins".
</p>

<b>EarthDesk: Save to file</b>

<p align="justify">
EarthDesk needs to be configured to save the image to a file rather than
place it on the desktop. The setting for this is in the general preferences
pane. The Quartz Composer patch will read this file at a time interval of
the users choice.
</p>
<center><img src="http://paulbourke.net/dome/EarthDesk4Dome/screen1.jpg" width="670" height="536" width=0></center><p>

<b>EarthDesk: Projection and zoom settings</b>

<p align="justify">
EarthDesk needs to be instructed to create an equirectangular projection, it is
this projection that the Quartz Composer patch will wrap onto a sphere. It would
be nice if EarthDesk had an option for a perfect 360 degree horizontal range,
since it doesn't the user needs to adjust the zoom so that at least 360 degrees
are visible. Controls are provided in the Quartz Composer composition to trim
the resulting image to 360 x 180 degrees before wrapping onto the sphere.
</p>
<center><img src="http://paulbourke.net/dome/EarthDesk4Dome/screen2.jpg" width="670" height="536" width=0></center><p>

<b>Quartz Composer Composition</b>
<p align="justify">
The Quartz Composer composition is well commented.
The following indicates some of the more important adjustments.
The reader is encouraged to explore Quartz Composer, it is a very capable
environment in which to create dynamic visual displays, including for planetariums.
It should be noted here there is a slight "hack" involved, that is, a fisheye
image isn't actually generated. It relies on the fact that to a first approximation
a circular objects in fisheye space is also circular.
</p>
<center><a href="http://paulbourke.net/dome/EarthDesk4Dome/screen3.jpg">
<img src="http://paulbourke.net/dome/EarthDesk4Dome/screen3_small.jpg" width="670" height="368" width=1></a>
</center><p>

<b>iDome example</b>
<p>
<center>
<table><tr><td>
<a href="http://paulbourke.net/dome/EarthDesk4Dome/idome1.jpg"><img src="http://paulbourke.net/dome/EarthDesk4Dome/idome1s.jpg" width=350 height=232 border=1></a>
</td><td>
<a href="http://paulbourke.net/dome/EarthDesk4Dome/idome2.jpg"><img src="http://paulbourke.net/dome/EarthDesk4Dome/idome2s.jpg" width=350 height=232 border=1></a>
</td></tr></table>
</center>
<p>

<b>Update (April 2016)</b><p>
<p align="justify">
As with any document of this type it can get out of date with updates in
software and operating systems. Version 7 of EarthDesk (this document update
based upon the release in April 2016) does things a little different and that
will be documented here.
</p>

<p align="justify">
The setting to instruct EarthDesk to save files is now in the Advanced tab,
select the "Screen Saver Only" option in the pop-down menu.
</p>
<center>
	<a href="http://paulbourke.net/dome/EarthDesk4Dome/update1.jpg">
	<img src="http://paulbourke.net/dome/EarthDesk4Dome/update1s.jpg" width=800 height=715 border=1></a>
</center><p>

<p align="justify">
The images are now saved in a different location, the users Library folder and
in the Application Support, see details below.
</p>
<center>
   <a href="http://paulbourke.net/dome/EarthDesk4Dome/update2.jpg">
   <img src="http://paulbourke.net/dome/EarthDesk4Dome/update2s.jpg" width=800 height=236 border=1></a>
</center><p>

<p align="justify">
The saving frequency can be adjusted in the Appearance tab.
The scale determines the longitude range, 80% seems to give 0 to 360. If the 
texture doesn't form a perfect seam this scale needs adjusting.
A new QC composition is provided <a href="http://paulbourke.net/dome/EarthDesk4Dome/EarthDesk4Dome2.zip">here</a>, it is
only slightly different from the previous version. Note the values in the image
crop will still need adjusting, the exact degree of image padding depends on
the aspect ratio of the your display. Normally it seems only a vertical letter box
is required to remove the black bands at the top and bottom of the saved image.
If you have pinching at the north and south pole, or back rings at the poles then
the values in this crop patch need adjusting.
</p>

<p align="justify">
Unfortunately my license for the earlier release is no longer valid so the examples
in this update have the unlicensed watermark.
</p>
<center>
   <a href="http://paulbourke.net/dome/EarthDesk4Dome/update3.jpg">
   <img src="http://paulbourke.net/dome/EarthDesk4Dome/update3s.jpg" width=800 height=516 border=1></a>
</center><p>

<p align="justify">
Note that while this is implemented for a spherical mirror, it could be easily modified
for simpler fisheye lens systems.
</p>
<center>
   <a href="http://paulbourke.net/dome/EarthDesk4Dome/update4.jpg">
   <img src="http://paulbourke.net/dome/EarthDesk4Dome/update4s.jpg" width=800 height=516 border=1></a>
</center><p>

</td></tr></table></center>
</body>
</html>
