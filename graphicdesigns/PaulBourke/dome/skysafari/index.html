<html>
<head>
<link rel=StyleSheet href="../../pdbstyle.css" type="text/css" media=all>
<title>SkySafari and dome projection</title>
</head>
<body>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script language="JavaScript">
<!--
   if (self.location.href != top.location.href) {
      top.location.href = self.location.href;
   }
-->
</script>


<center><table width=800><tr><td>

<center>
<h1>SkySafari and dome projection</h1>
Written by <a href="../index.html">Paul Bourke</a><br>
August 2011<p>
</center>
<p><br><p>

<p align="justify">
The following describes the presentation of imagery from the SkySafari software onto
a hemispherical dome. The general technique of using a screen capture plug-in for Quartz
Composer is introduced <a href="../screencapture/index.html">here in the context of Stellarium</a>,
as such that aspect will only be discussed in passing.
</p>

<p align="justify">
SkySafari presents a 180 degree fisheye view by default, if one had a data projector with
a full frame fisheye then this would be the end of the story. In reality few fisheye solutions
employ the full frame, they are often truncated for pixel efficiency. Some other fisheye lens
products don't have a constant relationship between distance from the centre and latitude.
Another common approach to single projector fulldome projection is the use of a spherical
mirror instead of a fisheye lens. The most general solution that supports all the above
is to apply the full fisheye image to a mesh that prewarps the image to correct for the
distortions, or apply the truncation. Unfortunately implementing this within the application
requires access to the source code, something not normally available for commercial packages.
</p>

<p align="justify">
The solution is to draw the fisheye to the display and somehow capture that image for
warping or truncation. Two free products that permit this are "pbmesh" (see the Kineme site)
and "v002 Screen Capture" patches for Quartz Composer.
The approach is illustrated below, the computer needs two displays, one connected to the 
projector and the other to a display which has many vertical pixels as possible. The Quartz
Composer editor window and the SkySafari window are placed on the display, the Quartz Composer
viewer window is presented fullscreen on the projector. The SkySafari window is made square and
as large as possible, the capture region for the V002 Screen Capture is set to match. In
the following a 30inch display is used, the resulting fisheye here is 1450 square which is
close to the maximum size required given the HD projector presenting in the dome.
</p>

<center>
<table>
<tr><td>
	<a href="http://paulbourke.net/dome/skysafari/screen1.jpg"><img src="http://paulbourke.net/dome/skysafari/screen1s.jpg" width=800 height=500 border=1></a><br>
	<font size=-1>Figure 1: Computer display, 1600 pixels tall, capture region 1450 pixels square</font>
	<p>
</td></tr>
<tr><td>
	<a href="http://paulbourke.net/dome/skysafari/screen2.jpg"><img src="http://paulbourke.net/dome/skysafari/screen2s.jpg" width=800 height=450 border=1></a><br>
	<font size=-1>Figure 2: Full screen secondary display for iDome, 1920x1080 pixels</a>
	<p>
</td></tr>
<tr><td>
   <a href="http://paulbourke.net/dome/skysafari/screen3.jpg"><img src="http://paulbourke.net/dome/skysafari/screen3s.jpg" width=800 height=533 border=1></a><br>
	<font size=-1>Figure 3: Photograph example on iDome</font>
	<p>
</td></tr>
</table>
</center>
<p>

<b>Notes</b>
<ul>
<li><p align="justify">
SkySafari only creates an inscribed 180 degree fisheye for a square window.
The easiest way to achieve this is to set the square capture region using the V002 patch and then
size the SkySafari window to match. See figure 1.
</p>
<li><p align="justify">
The resolution of the result on the dome is limited by the screen resolution of the
display the fisheye generating application is running on. The higher the resolution of this
display the better the result. For example for a good HD spherical mirror projection one
should aim for close to 1600 pixel high fisheye, this is only really possible with a 30 inch
2560x1600 pixel display.
</p>
<li><p align="justify">
If one was correcting for radial distortion of a fisheye lens then a smaller input fisheye
image could be used, for example, one close to the resolution of the fisheye projector. For
a truncated fisheye one would ideally use the resolution of the pre-truncated fisheye.
</p>
<li><p align="justify">
The Quartz Composer patch could be as simple as the following, also see figure 1.
</p>
<center>
	<img src="http://paulbourke.net/dome/skysafari/screen4.jpg" width=777 height=580 border=1>
</center>
</ul>

</td></tr></table></center>
</body>
</html>
