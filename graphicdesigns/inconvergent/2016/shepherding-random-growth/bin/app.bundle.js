!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;var newObj={};if(null!=obj)for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(newObj[key]=obj[key]);return newObj.default=obj,newObj}function main(){(0,_utils.printInfo)("running main. yess"),window.drawings||(window.drawings={});var story={introduction:scene.getSceneGrowthDetail,uniform:scene.getSceneGrowth,curvature:scene.getSceneGrowthDiff,"more-nodes":scene.getSceneGrowthDiffHigh,history:scene.getSceneHistory};Object.keys(story).forEach(function(sceneName){(0,_utils.printInfo)("updating: "+sceneName),(0,_utils.updateAndStartCanvas)(sceneName,story[sceneName])})}var _utils=__webpack_require__(1),_scenes=__webpack_require__(2),scene=_interopRequireWildcard(_scenes);main()},function(module,exports){"use strict";function printInfo(){for(var s="",_len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];for(var i=0;i<args.length;i++)s=s+" "+JSON.stringify(args[i]);console.log(s)}function printWarn(){for(var s="",_len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];for(var i=0;i<args.length;i++)s=s+" "+JSON.stringify(args[i]);console.warn(s)}function updateAndStartCanvas(name,getScene){function scrollHandler(){var inView=isInViewport(container),animId=window.drawings[canvasId];inView?animId||(printInfo("starting: ",canvasId),animloop(scene,canvasId)):animId&&(printInfo("stopping: ",canvasId),cancelAnimationFrame(animId),window.drawings[canvasId]=void 0)}function clickHandler(){window.removeEventListener("scroll",scrollHandler,!1),canvas.removeEventListener("click",clickHandler,!1),window.drawings[canvasId]&&(printInfo("stopping: ",canvasId),cancelAnimationFrame(window.drawings[canvasId]),window.drawings[canvasId]=void 0),updateAndStartCanvas(name,getScene)}var canvasId="canvas-"+name,containerId="container-"+name,cs=getCanvasSize(),width=cs.width,height=cs.height,canvasStr='<canvas width="'+width+'" height="'+height+'"\n  class="drawing" id="'+canvasId+'"></canvas>',container=document.getElementById(containerId);container.innerHTML=canvasStr;var canvas=document.getElementById(canvasId),ctx=canvas.getContext("2d"),scene=getScene(ctx,width,height);isInViewport(container)&&animloop(scene,canvasId),window.addEventListener("scroll",scrollHandler,!1),canvas.addEventListener("click",clickHandler,!1)}function animloop(f,canvasId){window.drawings[canvasId]=requestAnimationFrame(function(){return animloop(f,canvasId)}),f()}function getCanvasSize(){var width=Math.max(window.innerWidth-60,320),height=Math.max(.6*window.innerHeight,400);return{width:width,height:height}}function isInViewport(element){var rect=element.getBoundingClientRect(),html=document.documentElement,bottom=rect.bottom,top=rect.top,mid=.5*(bottom+top);return mid>0&&mid<(window.innerHeight||html.clientHeight)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.printInfo=printInfo,exports.printWarn=printWarn,exports.updateAndStartCanvas=updateAndStartCanvas,exports.animloop=animloop,exports.getCanvasSize=getCanvasSize,exports.isInViewport=isInViewport,function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}()},function(module,exports,__webpack_require__){"use strict";function getSceneGrowthDetail(ctx,width,height){function scene(){ctx.fillStyle=WHITE,(0,_draw.clear)(ctx,width,height),ctx.fillStyle=GRAY;D.step(attract,reject,splitCandidate,splitObligatory,splitProb,!1);ctx.lineWidth=2,ctx.strokeStyle=CYAN,D.points.forEach(function(p){p.nearest&&p.nearest.forEach(function(pn){ctx.beginPath(),ctx.moveTo(p.x,p.y),ctx.lineTo(pn.x,pn.y),ctx.stroke()})}),ctx.lineWidth=5,ctx.strokeStyle=GRAY,(0,_draw.drawEdges)(ctx,D.points),D.points.forEach(function(p){var x=p.x,y=p.y;ctx.beginPath(),p.age<60?ctx.arc(x,y,1.5*dotSize,0,TWOPI):ctx.arc(x,y,dotSize,0,TWOPI),ctx.fill()})}ctx.strokeStyle=GRAY,ctx.fillStyle=GRAY;var num=10,dotSize=5,rad=20,near=40,far=100,maxNum=150,stp=.3,attract=.1*stp,reject=.01*stp,splitCandidate=near,splitObligatory=4*near,splitProb=.005,boundary=(0,_draw.getBoundary)(width,height),points=_differential.Differential.getConnectedCircle(num,boundary.xMid,boundary.yMid,rad),D=new _differential.Differential(points,maxNum,near,far);return scene}function getSceneGrowth(ctx,width,height){function scene(){ctx.fillStyle=WHITE,(0,_draw.clear)(ctx,width,height),ctx.fillStyle=GRAY;D.step(attract,reject,splitCandidate,splitObligatory,splitProb,!1);D.points.forEach(function(p){var x=p.x,y=p.y;ctx.beginPath(),p.age<60?ctx.arc(x,y,1.7*dotSize,0,TWOPI):ctx.arc(x,y,dotSize,0,TWOPI),ctx.fill()}),ctx.strokeStyle=GRAY,(0,_draw.drawEdges)(ctx,D.points)}ctx.strokeStyle=GRAY,ctx.fillStyle=GRAY,ctx.lineWidth=4;var num=10,dotSize=3,rad=20,near=13,far=70,maxNum=500,stp=.07,attract=.1*stp,reject=.01*stp,splitCandidate=near,splitObligatory=4*near,splitProb=.005,boundary=(0,_draw.getBoundary)(width,height),points=_differential.Differential.getConnectedCircle(num,boundary.xMid,boundary.yMid,rad),D=new _differential.Differential(points,maxNum,near,far);return scene}function getSceneGrowthDiff(ctx,width,height){function scene(){ctx.fillStyle=WHITE,(0,_draw.clear)(ctx,width,height),ctx.fillStyle=CYAN;D.stepCurv(attract,reject,splitCandidate,splitObligatory,splitProbScale,minCurv);ctx.fillStyle=CYAN,ctx.strokeStyle=CYAN,D.points.forEach(function(p){if(p.curv){var x=p.x,y=p.y;ctx.beginPath(),ctx.arc(x,y,12*p.curv,0,TWOPI),ctx.fill(),ctx.stroke()}}),ctx.fillStyle=GRAY,D.points.forEach(function(p){var x=p.x,y=p.y;ctx.beginPath(),p.age<60?ctx.arc(x,y,1.7*dotSize,0,TWOPI):ctx.arc(x,y,dotSize,0,TWOPI),ctx.fill()}),ctx.strokeStyle=GRAY,(0,_draw.drawEdges)(ctx,D.points)}ctx.lineWidth=3,ctx.strokeStyle=GRAY,ctx.fillStyle=CYAN;var num=10,dotSize=3,rad=20,near=13,far=70,maxNum=500,stp=.07,attract=.1*stp,reject=.01*stp,splitCandidate=near,splitObligatory=4*near,splitProbScale=.7,minCurv=.15,boundary=(0,_draw.getBoundary)(width,height),points=_differential.Differential.getConnectedCircle(num,boundary.xMid,boundary.yMid,rad),D=new _differential.Differential(points,maxNum,near,far);return scene}function getSceneGrowthDiffHigh(ctx,width,height){function scene(){(0,_draw.clear)(ctx,width,height);D.stepCurv(attract,reject,splitCandidate,splitObligatory,splitProbScale,minCurv);(0,_draw.drawEdges)(ctx,D.points)}ctx.lineWidth=3,ctx.strokeStyle=GRAY,ctx.fillStyle=WHITE;var num=10,rad=20,near=10,far=50,maxNum=800,stp=.07,attract=.1*stp,reject=.01*stp,splitCandidate=near,splitObligatory=4*near,splitProbScale=.7,minCurv=.15,boundary=(0,_draw.getBoundary)(width,height),points=_differential.Differential.getConnectedCircle(num,boundary.xMid,boundary.yMid,rad),D=new _differential.Differential(points,maxNum,near,far);return scene}function getSceneHistory(ctx,width,height){function scene(){var alive=D.step(attract,reject,splitCandidate,splitObligatory,splitProb);alive&&((0,_draw.drawDots)(ctx,points,.5,!0),D.points.forEach(function(p){(0,_draw.stroke)(ctx,numDots,p,p.r)}),Math.random()<.1&&D.points.forEach(function(p){(0,_draw.stroke)(ctx,3*numDots,p,p.r)}))}ctx.fillStyle="rgba(0, 0, 0, 0.1)";var num=10,rad=20,near=4,far=100,maxNum=600,stp=.1,attract=.1*stp,reject=.01*stp,splitCandidate=near,splitObligatory=4*near,splitProb=.005,numDots=5,boundary=(0,_draw.getBoundary)(width,height),points=_differential.Differential.getConnectedCircle(num,boundary.xMid,boundary.yMid,rad),D=new _differential.Differential(points,maxNum,near,far);return scene}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSceneGrowthDetail=getSceneGrowthDetail,exports.getSceneGrowth=getSceneGrowth,exports.getSceneGrowthDiff=getSceneGrowthDiff,exports.getSceneGrowthDiffHigh=getSceneGrowthDiffHigh,exports.getSceneHistory=getSceneHistory;var _draw=(__webpack_require__(3),__webpack_require__(4)),_differential=__webpack_require__(5),TWOPI=2*Math.PI,WHITE="rgba(255, 255, 255, 1.0)",GRAY="rgba(0, 0, 0, 0.6)",CYAN="rgba(0, 200, 200, 0.5)"},function(module,exports,__webpack_require__){"use strict";function getNs(n,v){for(var res=[],i=0;i<n;i++)res.push(v);return res}function getRnd(n,min,max){for(var res=[],i=0;i<n;i++)res.push(min+Math.random()*(max-min));return res}function getRndXRndY(n,xMin,xMax,yMin,yMax){for(var res=[],i=0;i<n;i++)res.push({x:xMin+Math.random()*(xMax-xMin),y:yMin+Math.random()*(yMax-yMin)});return res}function getRndXLinspaceY(n,xMin,xMax,yMin,yMax){for(var res=[],s=(yMax-yMin)/n,y=yMin,i=0;i<n;i++)res.push({x:xMin+Math.random()*(xMax-xMin),y:y}),y+=s;return res}function getLinspaceXLinspaceY(n,xMin,xMax,yMin,yMax){for(var res=[],sX=(xMax-xMin)/n,sY=(yMax-yMin)/n,x=xMin,y=yMin,i=0;i<n;i++)res.push({x:x,y:y}),x+=sX,y+=sY;return res}function getRndCirc(n,ix,iy,rad){for(var res=[],i=0;i<n;i++){var a=Math.random()*TWOPI,x=ix+Math.cos(a)*rad,y=iy+Math.sin(a)*rad;res.push({x:x,y:y})}return res}function limit(v,ma,mi){return Math.max(Math.min(v,ma),mi)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNs=getNs,exports.getRnd=getRnd,exports.getRndXRndY=getRndXRndY,exports.getRndXLinspaceY=getRndXLinspaceY,exports.getLinspaceXLinspaceY=getLinspaceXLinspaceY,exports.getRndCirc=getRndCirc,exports.limit=limit;var TWOPI=(__webpack_require__(1),2*Math.PI)},function(module,exports,__webpack_require__){"use strict";function stroke(ctx,n,a,b){for(var dx=b.x-a.x,dy=b.y-a.y,i=0;i<n;i++){var rnd=Math.random();ctx.beginPath(),ctx.rect(a.x+rnd*dx,a.y+rnd*dy,1,1),ctx.fill()}}function drawDots(ctx,points,rad,fill){points.forEach(function(p){var x=p.x,y=p.y;ctx.beginPath(),ctx.arc(x,y,rad,0,TWOPI),fill?ctx.fill():ctx.stroke()})}function drawEdges(ctx,points){ctx.beginPath(),points.forEach(function(p){var x=p.x,y=p.y,r=p.r;ctx.moveTo(x,y),ctx.lineTo(r.x,r.y)}),ctx.stroke()}function drawPathDots(ctx,p,rad){for(var num=1,i=1;i<p.length;i++){for(var x2=p[i].x,y2=p[i].y,x1=p[i-1].x,y1=p[i-1].y,k=0;k<num;k++)ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.stroke();ctx.beginPath(),ctx.arc(p[i].x,p[i].y,rad,0,TWOPI),ctx.fill()}}function clear(ctx,width,height){ctx.beginPath(),ctx.rect(0,0,width,height),ctx.fill()}function getBoundary(width,height){var edgeX=5*width/100,edgeTopY=.2*height,edgeBottomY=.2*height,xl=0,xr=width,yb=height,yt=0,xMin=edgeX,xMax=width-edgeX,yMin=edgeTopY,yMax=height-edgeBottomY,yMid=.5*(yMax+yMin),xMid=.5*(xMax+xMin);return{xMin:xMin,xMax:xMax,yMin:yMin,yMax:yMax,yMid:yMid,xMid:xMid,xl:xl,xr:xr,yb:yb,yt:yt}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.stroke=stroke,exports.drawDots=drawDots,exports.drawEdges=drawEdges,exports.drawPathDots=drawPathDots,exports.clear=clear,exports.getBoundary=getBoundary;var TWOPI=(__webpack_require__(1),Math.PI,2*Math.PI)},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function pointsForce(a,b){var dx=a.x-b.x,dy=a.y-b.y,dst=dx*dx+dy*dy;return dst>0&&(dst=Math.sqrt(dx*dx+dy*dy)),{dx:dx,dy:dy,dst:dst}}function dst2(a,b){var dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Differential=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_array=__webpack_require__(3),_kdTree=__webpack_require__(6),TWOPI=2*Math.PI,INITIALAGE=60;exports.Differential=function(){function Differential(points,maxNum,near,far){_classCallCheck(this,Differential),this.points=points,this.near=near,this.far=far,this.far2=far*far,this.maxNum=maxNum,this.tree=new _kdTree.kdTree(this.points,dst2,["x","y"])}return _createClass(Differential,[{key:"optimizePositions",value:function(attract,reject){for(var _this=this,next=[],i=0;i<this.points.length;i++)next.push({x:0,y:0});for(var _loop=function(_i){var p=_this.points[_i],vl=pointsForce(p,p.l),vr=pointsForce(p,p.r),dx=0,dy=0;vl.dst>_this.near?(dx-=vl.dx/vl.dst,dy-=vl.dy/vl.dst):(dx+=vl.dx/vl.dst,dy+=vl.dy/vl.dst),vr.dst>_this.near?(dx-=vr.dx/vr.dst,dy-=vr.dy/vr.dst):(dx+=vr.dx/vr.dst,dy+=vr.dy/vr.dst),next[_i].x+=dx*attract,next[_i].y+=dy*attract;var nearest=_this.tree.nearest({x:p.x,y:p.y},_this.points.length,_this.far2);p.nearest=[],nearest.forEach(function(o){var pn=o[0];if(pn!==p&&pn!==p.r&&pn!==p.l){var vv=pointsForce(p,pn);p.nearest.push(pn),dx+=vv.dx*(_this.far/vv.dst-1),dy+=vv.dy*(_this.far/vv.dst-1)}}),next[_i].x+=dx*reject,next[_i].y+=dy*reject},_i=0;_i<this.points.length;_i++)_loop(_i);for(var _i2=0;_i2<this.points.length;_i2++)this.points[_i2].x+=next[_i2].x,this.points[_i2].y+=next[_i2].y,this.points[_i2].age+=1}},{key:"splitEdges",value:function(splitCandidate,splitObligatory,splitProb){var _this2=this;this.points.forEach(function(p){var dx=p.x-p.r.x,dy=p.y-p.r.y,dd=Math.sqrt(dx*dx+dy*dy),rnd=Math.random();if(dd>splitObligatory||dd>splitCandidate&&rnd<splitProb){var mx=.5*(p.x+p.r.x),my=.5*(p.y+p.r.y),newPoint={x:mx,y:my,r:p.r,l:p,age:0};p.r.l=newPoint,p.r=newPoint,_this2.points.push(newPoint),_this2.tree.insert(newPoint)}})}},{key:"curvSplitEdges",value:function(splitCandidate,splitObligatory,splitProbScale,minCurv){var _this3=this;this.points.forEach(function(p){var rdx=p.x-p.r.x,rdy=p.y-p.r.y,rdd=Math.sqrt(rdx*rdx+rdy*rdy),ldx=p.x-p.l.x,ldy=p.y-p.l.y,ldd=Math.sqrt(ldx*ldx+ldy*ldy),rnd=Math.random(),curv=1-Math.abs(rdx/rdd*ldx/ldd+rdy/rdd*ldy/ldd);if(p.curv=curv,rdd>splitObligatory||curv>minCurv&&rdd>splitCandidate&&rnd<curv*splitProbScale){var mx=.5*(p.x+p.r.x),my=.5*(p.y+p.r.y),newPoint={x:mx,y:my,r:p.r,l:p,age:0};p.r.l=newPoint,p.r=newPoint,_this3.points.push(newPoint),_this3.tree.insert(newPoint)}})}},{key:"step",value:function(attract,reject,splitCandidate,splitObligatory,splitProb){var numPoints=this.points.length;return numPoints<this.maxNum&&(this.optimizePositions(attract,reject),this.splitEdges(splitCandidate,splitObligatory,splitProb),!0)}},{key:"stepCurv",value:function(attract,reject,splitCandidate,splitObligatory,splitProbScale,minCurv){var numPoints=this.points.length;return numPoints<this.maxNum&&(this.optimizePositions(attract,reject),this.curvSplitEdges(splitCandidate,splitObligatory,splitProbScale,minCurv),!0)}}],[{key:"getConnectedCircle",value:function(num,cx,cy,rad){var angles=(0,_array.getRnd)(num,0,TWOPI).sort(),points=angles.map(function(a){var x=cx+Math.sin(a)*rad,y=cy+Math.cos(a)*rad;return{x:x,y:y}});return points.forEach(function(p,i){var l=(num+i-1)%num,r=(num+i+1)%num;p.l=points[l],p.r=points[r],p.age=INITIALAGE}),points}}]),Differential}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(root,factory){__WEBPACK_AMD_DEFINE_ARRAY__=[exports],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(void 0,function(exports){function Node(obj,dimension,parent){this.obj=obj,this.left=null,this.right=null,this.parent=parent,this.dimension=dimension}function kdTree(points,metric,dimensions){function buildTree(points,depth,parent){var median,node,dim=depth%dimensions.length;return 0===points.length?null:1===points.length?new Node(points[0],dim,parent):(points.sort(function(a,b){return a[dimensions[dim]]-b[dimensions[dim]]}),median=Math.floor(points.length/2),node=new Node(points[median],dim,parent),node.left=buildTree(points.slice(0,median),depth+1,node),node.right=buildTree(points.slice(median+1),depth+1,node),node)}function loadTree(data){function restoreParent(root){root.left&&(root.left.parent=root,restoreParent(root.left)),root.right&&(root.right.parent=root,restoreParent(root.right))}self.root=data,restoreParent(self.root)}var self=this;Array.isArray(points)?this.root=buildTree(points,0,null):loadTree(points,metric,dimensions),this.toJSON=function(src){src||(src=this.root);var dest=new Node(src.obj,src.dimension,null);return src.left&&(dest.left=self.toJSON(src.left)),src.right&&(dest.right=self.toJSON(src.right)),dest},this.insert=function(point){function innerSearch(node,parent){if(null===node)return parent;var dimension=dimensions[node.dimension];return point[dimension]<node.obj[dimension]?innerSearch(node.left,node):innerSearch(node.right,node)}var newNode,dimension,insertPosition=innerSearch(this.root,null);return null===insertPosition?void(this.root=new Node(point,0,null)):(newNode=new Node(point,(insertPosition.dimension+1)%dimensions.length,insertPosition),dimension=dimensions[insertPosition.dimension],void(point[dimension]<insertPosition.obj[dimension]?insertPosition.left=newNode:insertPosition.right=newNode))},this.remove=function(point){function nodeSearch(node){if(null===node)return null;if(node.obj===point)return node;var dimension=dimensions[node.dimension];return point[dimension]<node.obj[dimension]?nodeSearch(node.left,node):nodeSearch(node.right,node)}function removeNode(node){function findMin(node,dim){var dimension,own,left,right,min;return null===node?null:(dimension=dimensions[dim],node.dimension===dim?null!==node.left?findMin(node.left,dim):node:(own=node.obj[dimension],left=findMin(node.left,dim),right=findMin(node.right,dim),min=node,null!==left&&left.obj[dimension]<own&&(min=left),null!==right&&right.obj[dimension]<min.obj[dimension]&&(min=right),min))}var nextNode,nextObj,pDimension;return null===node.left&&null===node.right?null===node.parent?void(self.root=null):(pDimension=dimensions[node.parent.dimension],void(node.obj[pDimension]<node.parent.obj[pDimension]?node.parent.left=null:node.parent.right=null)):void(null!==node.right?(nextNode=findMin(node.right,node.dimension),nextObj=nextNode.obj,removeNode(nextNode),node.obj=nextObj):(nextNode=findMin(node.left,node.dimension),nextObj=nextNode.obj,removeNode(nextNode),node.right=node.left,node.left=null,node.obj=nextObj))}var node;node=nodeSearch(self.root),null!==node&&removeNode(node)},this.nearest=function(point,maxNodes,maxDistance){function nearestSearch(node){function saveNode(node,distance){bestNodes.push([node,distance]),bestNodes.size()>maxNodes&&bestNodes.pop()}var bestChild,linearDistance,otherChild,i,dimension=dimensions[node.dimension],ownDistance=metric(point,node.obj),linearPoint={};for(i=0;i<dimensions.length;i+=1)i===node.dimension?linearPoint[dimensions[i]]=point[dimensions[i]]:linearPoint[dimensions[i]]=node.obj[dimensions[i]];return linearDistance=metric(linearPoint,node.obj),null===node.right&&null===node.left?void((bestNodes.size()<maxNodes||ownDistance<bestNodes.peek()[1])&&saveNode(node,ownDistance)):(bestChild=null===node.right?node.left:null===node.left?node.right:point[dimension]<node.obj[dimension]?node.left:node.right,nearestSearch(bestChild),(bestNodes.size()<maxNodes||ownDistance<bestNodes.peek()[1])&&saveNode(node,ownDistance),void((bestNodes.size()<maxNodes||Math.abs(linearDistance)<bestNodes.peek()[1])&&(otherChild=bestChild===node.left?node.right:node.left,null!==otherChild&&nearestSearch(otherChild))))}var i,result,bestNodes;if(bestNodes=new BinaryHeap(function(e){return-e[1]}),maxDistance)for(i=0;i<maxNodes;i+=1)bestNodes.push([null,maxDistance]);for(self.root&&nearestSearch(self.root),result=[],i=0;i<Math.min(maxNodes,bestNodes.content.length);i+=1)bestNodes.content[i][0]&&result.push([bestNodes.content[i][0].obj,bestNodes.content[i][1]]);return result},this.balanceFactor=function(){function height(node){return null===node?0:Math.max(height(node.left),height(node.right))+1}function count(node){return null===node?0:count(node.left)+count(node.right)+1}return height(self.root)/(Math.log(count(self.root))/Math.log(2))}}function BinaryHeap(scoreFunction){this.content=[],this.scoreFunction=scoreFunction}BinaryHeap.prototype={push:function(element){this.content.push(element),this.bubbleUp(this.content.length-1)},pop:function(){var result=this.content[0],end=this.content.pop();return this.content.length>0&&(this.content[0]=end,this.sinkDown(0)),result},peek:function(){return this.content[0]},remove:function(node){for(var len=this.content.length,i=0;i<len;i++)if(this.content[i]==node){var end=this.content.pop();return void(i!=len-1&&(this.content[i]=end,this.scoreFunction(end)<this.scoreFunction(node)?this.bubbleUp(i):this.sinkDown(i)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(n){for(var element=this.content[n];n>0;){var parentN=Math.floor((n+1)/2)-1,parent=this.content[parentN];if(!(this.scoreFunction(element)<this.scoreFunction(parent)))break;this.content[parentN]=element,this.content[n]=parent,n=parentN}},sinkDown:function(n){for(var length=this.content.length,element=this.content[n],elemScore=this.scoreFunction(element);;){var child2N=2*(n+1),child1N=child2N-1,swap=null;if(child1N<length){var child1=this.content[child1N],child1Score=this.scoreFunction(child1);child1Score<elemScore&&(swap=child1N)}if(child2N<length){var child2=this.content[child2N],child2Score=this.scoreFunction(child2);child2Score<(null==swap?elemScore:child1Score)&&(swap=child2N)}if(null==swap)break;this.content[n]=this.content[swap],this.content[swap]=element,n=swap}}},this.kdTree=kdTree,exports.kdTree=kdTree,exports.BinaryHeap=BinaryHeap})}]);