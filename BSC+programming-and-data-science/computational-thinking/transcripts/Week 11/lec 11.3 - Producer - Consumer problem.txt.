Computational Thinking
Professor. Madhavan Mukund
Professor. G. Venkatesh
Department of Computer Science
Chennai Mathematical Institute
Indian Institute of Technology, Madras
Producer - Consumer Problem
Professor Madhavan Mukund: So, we were talking about this remote procedure call and we were
saying that you do not have to wait for the answer to be ready, so you do not have to like a
normal procedure call you do not stand around waiting, you can go and do something else.
Professor G. Venkatesh: You call this guy in Bangalore and told him to print some garbage
value.
Professor Madhavan Mukund: Meanwhile or doing something.
Professor G. Venkatesh: Meanwhile do something else.
Professor Madhavan Mukund: And then we said that in order to check when the job is done
either we have to.
Professor G. Venkatesh: Pole.
Professor Madhavan Mukund: Pole or that person will kind of.
Professor G. Venkatesh: Pre-empt.
Professor Madhavan Mukund: Pre-empt us will interrupt us and say your ticket.
Professor G. Venkatesh: Job is ready please take.
Professor Madhavan Mukund: So, it is like you some of these food court have this say, they give
you a buzzer.
Professor G. Venkatesh: They give buzzer.
Professor Madhavan Mukund: And when the food is ready so you can go start chatting with your
friends at the table and when the food is ready they will give you a buzz and then you go and
pick it up.
Professor G. Venkatesh: pre-empting.
Professor Madhavan Mukund: They are pre-empting whatever you are doing then. But now there
is a difficulty is that I mean if we said that this is across the city and all that, so this pre-emption
also requires one message to be sent.
Professor G. Venkatesh: Or polling also.
Professor Madhavan Mukund: Polling also requires you do not know whether that guy has got
your message or not.
Professor G. Venkatesh: May have lost message get lost.
Professor Madhavan Mukund: Not lost but you do not know how long it took for the message to
reach see.
Professor G. Venkatesh: It gets lost internet you know.
Professor Madhavan Mukund: That also happen
Professor G. Venkatesh: You cannot rely on it.
Professor Madhavan Mukund: So, it is a bit of a messy thing that way to rely on even more
messages like this too, so keep checking this.
Professor G. Venkatesh: This is a better way, I mean, if I like that earlier thing procedure call.
Professor Madhavan Mukund: So, earlier we said we had this tray or something, so I put my
parameters in the tray and when you are done you put your answer in the tray and I pick it up so I
only have to check the tray, sometimes, that is how it works.
Professor G. Venkatesh: That is how it was.
Professor Madhavan Mukund: When it was.
Professor G. Venkatesh: Why do we change it?
Professor Madhavan Mukund: But we changed it because the tray is now I mean the first of all it
takes a long time for the procedure to finish, so instead of waiting for that tray to get first of all
the trays there is no tray, actually.
Professor G. Venkatesh: Let us, make a tray.
Professor Madhavan Mukund: Because we are.
Professor G. Venkatesh: we had the tray. Let us, we have a tray it give we start the guy and say
give a task.
Professor Madhavan Mukund: And say here.
Professor G. Venkatesh: He has empty tray again also.
Professor Madhavan Mukund: So, who has the tray?
Professor G. Venkatesh: I have the tray, I give an empty tray.
Professor Madhavan Mukund: But the tray belongs to me.
Professor G. Venkatesh: I mean ideally it belongs to me.
Professor Madhavan Mukund: Because how it is object, so the tray has to belong to somebody.
Professor G. Venkatesh: The tray belongs to me, let us say.
Professor Madhavan Mukund: So, I am the, I am an object and I want some work done by
another object.
Professor G. Venkatesh: So, I have a tray.
Professor Madhavan Mukund: I have a tray.
Professor G. Venkatesh: I make an object and I make a tray. So, I call object I have the tray.
Professor Madhavan Mukund: I said here is a tray for you to give me the answer back.
Something like that.
Professor G. Venkatesh: Something like that.
Professor Madhavan Mukund: And then what does that guy do? That guy now after.
Professor G. Venkatesh:
Professor Madhavan Mukund: Pre-emptying me he puts the thing in the tray.
Professor G. Venkatesh: He does not have to pre-empt me or he does not have to I do not have to
poll him..
Professor Madhavan Mukund: So, I just keep checking the tray.
Professor G. Venkates: I can check the tray. There is nothing in the tray it means the guy's is not
finished, something in the tray means he is finished.
Professor Madhavan Mukund: So, I am just checking the tray, but I am not reminding or
anything like that, I just go at some.
Professor G. Venkatesh: Tray is with me ways, my tray only.
Professor Madhavan Mukund: So, if it is not there it is not there, I mean I cannot tell that guy
hurry up.
Professor G. Venkatesh: No No I cannot do that. Anyways it is not . So, I can keep checking my
tray and when he is done .
Professor Madhavan Mukund: He put something there.
Professor G. Venkatesh: He will put the thing in the tray, I will see tray it is there, now suddenly
okay it is there, so I take it and do it.
Professor Madhavan Mukund: So, that is need, so if he has finished it will be there in the tray, he
has not finished they will be nothing in the tray.
Professor G. Venkatesh: Nothing in the tray.
Professor Madhavan Mukund: And then we go ahead.
Professor G. Venkatesh: That is nicer.
Professor Madhavan Mukund: That is nicer thing, but then we do not have to rely on any further
pre-emption pulling.
Professor G. Venkatesh: All this nonsense, right. So, many complications.
(Refer Slide Time: 04:03)
Professor Madhavan Mukund: So, we just have this thing in the between, so we have this guy
who was calling and we have this guy whose is executing, so this is our object and this is the
caller, so what this guy will say is that, now here here is a tray, so execute this P A, B, C and
here is my tray X and this guy will then say okay here is the answer and put it in.
Professor G. Venkatesh: Going to this tray, when he is finished.
Professor Madhavan Mukund: When he is finished.
Professor G. Venkatesh: So, this caller A only difference is now this caller called P A, B, C and
he went on.
Professor Madhavan Mukund; So, the caller now after doing this is doing something else and
periodically it keeps checking this tray.
Professor G. Venkatesh: Keep checking the tray. And if.
Professor Madhavan Mukund: And if it has some other work to do which does not involve this
value, it can continue do that.
Professor G. Venkatesh: Can continue do that.
Professor Madhavan Mukund: Some point it might have to.
Professor G. Venkatesh: Wait.
Professor Madhavan Mukund: Wait for the X that is something depending on what is it.
Professor G. Venkatesh: Mean value is object basically has got the task, it will start executing the
task and when it is finished with the task it does it need to wait for the caller, or preamp the caller
or do anything.
Professor Madhavan Mukund: Exactly. So.
Professor G. Venkatesh: He just as a tray it will go put the value in the tray.
Professor Madhavan Mukund: So, as far as the object is concerned it's job is done and now it
cannot be mean, it can go and whatever watch a movie.
Professor G. Venkatesh: In principle, see the caller can even give it two tasks, he can give it P A,
B, C and he can give it Q A, B, C one after the other.
Professor Madhavan Mukund: And say put it and for each of them it will give it a different.
Professor G. Venkatesh: Or on the same tray you can have multiple buckets like pockets or
whatever.
Professor Madhavan Mukund: So, you can call it, so you can call some P, you can call some Q
and with each of them basically there is an associated, so this one is associated here, so maybe as
I said there is the same tray has two compartments, so as part of the procedure call there is some
information which is pass saying which tray to put the answer.
Professor G. Venkatesh: Something like that or if you do not have at this okay or you only need
to know that the result is the result of P, so when he returns it he will say I have result of P, result
of Q he will say and he will put it in this. So, I can create in some sense I can create no, in the
counter we discussed right, typically you go to the counters if you sign Q in front of it, because
there is already one person there and 5 people may be coming you know. So, there were standing
in Q, so this could be a Q. So, similarly and when that person finishes his work he gives the
result back, so this could be a Q, this messages can be a Q and this results can all.
Professor Madhavan Mukund: So, basically you are so so if we draw this picture in a different
way slightly better way.
(Refer Slide Time: 06:37)
So, we have this our friend the object here and I have a caller here, so there is a there is this so
first I had centre P A,B,C procedure and then after that kind of I decided I wanted also call Q A,
B, C and then maybe something else.
Professor G. Venkatesh: And I do not need to wait for P A, B, C to finish before Q A, B, C.
Professor Madhavan Mukund: So, I just keep saying do this and do this do this.
Professor G. Venkatesh: Do this do this, that guy will have an in tray, in tray were he all over.
Professor Madhavan Mukund: And now here I have correspondingly some kind of a kind of a
tray like thing, so where this guy will start putting answers. So, let me call it, what should I say?
Answer, so first I will get say the P answer and then when that guy is done you put the Q answer
after that, so whatever ordered this goes in this order, in the same order the answers will be piled
Professor G. Venkatesh: Come back.
Professor Madhavan Mukund; So, then I as a caller I will first say okay what is the first thing in
this thing, it should be the answer to P and then what is this thing here it should be the answer I
mean the next thing will be and so I will have a sequence.
Professor G. Venkatesh: Sequence on the sales back and figure out.
Professor Madhavan Mukund: So, therefore
Professor G. Venkatesh: I guess sequence tasks in sequence 1, 2, 3, 4, I get the answer also
sequence.
Professor Madhavan Mukund: So, basically the caller knows that, if the object knows that if the
caller calls me for each caller there is a fixed place to go and put the answer and the caller can
figure out what the answer corresponds to. Because here are all
s answers from me
Professor G.Venkatesh: So, this guy is the guy who is doing the work and this guy is the guy
who is consuming the result this guy.
Professor Madhavan Mukund: And of course this guy might be doing it on behalf of someone
else, so he might be in turn passing on the answers.
Professor G. Venkatesh: Is this what they mean when they say producer and consumer.
Professor Madhavan Mukund: So, in some sense well you can think of these answers as being
produced by this object, because the object is doing some work. So, if you can think of the
answers are being produced by the object after doing some work and this caller is.
Professor G. Venkatesh: Consuming.
Professor Madhavan Mukund: Consuming the answers to do some.
Professor G. Venkatesh: Further work again.
Professor Madhavan Mukund: So, it is exactly like again going back to our fast food counter at
the at the food court, so this guy is a guy preparing the food, so you place your order.
Professor G. Venkatesh: Another guy also may apply, many people place order.
Professor Madhavan Mukund: Many place the order this guy keep producing the food in the
order in the sequence which order.
Professor G. Venkatesh: Sequence in which orders came.
Professor Madhavan Mukund: And then you will eat it, so you consume.
Professor G. Venkatesh: You yourself can place the second order. I order something I forgot
something I have ordered again.
Professor Madhavan Mukund: Or you might to save time you might order your dessert while
before.
Professor G. Venkatesh: Before you finish.
Professor Madhavan Mukund: So, this is that thing, so this is producer and consumer. So, this
guy is so with respect to this answer tray this answer tray.
Professor G. Venkatesh: Is a Q.
Professor Madhavan Mukund: Is a Q, where this guy is generating the items into this Q and this
guy is.
Professor G. Venkatesh: Consuming them.
Professor Madhavan Mukund: Consuming them.
Professor G. Venkatesh: So, the consumer is asking the producer task.
Professor Madhavan Mukund: Task.
Professor G. Venkatesh: Getting the task one after the other, so it goes into Q.
Professor Madhavan Mukund: And then as the Q is executed by the producer, so as each order
comes for this restaurant, so as each order comes you prepare that order and put it back into the
service tray and then in the service tray you pick up one at a time, so that it.
Professor G. Venkatesh: This is neat I think this model is nice, this producer consumer model, it
seems to have simplified the task of.
Professor Madhavan Mukund: So, now you have kind.
Professor G. Venkatesh: Pause.
Professor Madhavan Mukund: Of avoided this thing about polling and because see this tray is
now in this case the tray is sitting with the caller.
Professor G. Venkatesh: Caller.
Professor Madhavan Mukund; Caller has to check whether my tray has got a value or not, I do
not have to go out and ask.
Professor G. Venkatesh: Do not all that. So, I have a very simple method now, so it looks like
now it is like a remote procedure call only, I call a remote procedure, only difference is that
earlier when I call the remote procedure, I stopped, now I do not stop.
Professor Madhavan Mukund: Now, you will not stop, so I could have call men many different
people I guess.
Professor G. Venkatesh: Many remote procedure calls
Professor Madhavan Mukund: Even the same person I can give many calls one after the other
and then as and my.
Professor G. Venkatesh: Same guy can also I can keep giving task.
Professor Madhavan Mukund; But those will come in this Q length.
Professor G. Venkatesh: Same way they will come in the same way.
Professor Madhavan Mukund; And then whenever I want I can go to my appropriate tray, so
there will be a tray for this object there will be a similar tray for your mirror object.
Professor G. Venkatesh: Another object.
Professor Madhavan Mukund; So, all the answers from each object will come into this Q and
then I depending on which one I need I can go and look at the tray and.
Professor G. Venkatesh: So, for class teacher physics teacher example, class teacher starts the
physics teacher, class teacher starts the chemistry teacher, maths teacher gives it
s the task and
they return back the result in.
Professor Madhavan Mukund: So, the class teacher will have now 3 trays.
Professor G. Venkatesh: 3 trays.
(Refer Slide Time: 11:32)
Professor Madhavan Mukund: The class teacher will have a physics tray, a maths tray and a
chemistry tray and now there are these 3 different.
Professor G. Venkatesh: Objects.
Professor Madhavan Mukund: Objects on the other side, so there is a physics object physics class
teacher physics teacher a math teacher and a chemistry teacher.
Professor G. Venkatesh: And the chemistry teacher can only talk to a chemistry tray, class
teachers are only.
Professor Madhavan Mukund: Exactly, so that is the whole point.
Professor G. Venkatesh: That is the whole point.
Professor Madhavan Mukund: So, now you will tell this person to do something and then that
person only knows about this thing.
Professor G. Venkatesh: I see.
Professor Madhavan Mukund: And then you tell this guy to do something this guy knows only
about the maths tray and you tell this guy to do something this guy knows only about chemistry
tray. So, therefore the answers will come in different orders perhaps, but they will come to the.
Professor G. Venkatesh: They all come and sit in this place.
Professor Madhavan Mukund: So, I just have to keep checking each tray, so if I check the math
tray and something is there and I have got the math answer even though physics answer may not
have come.
Professor G. Venkatesh: I do not even need to check with the math guy, nothing you need to do.
Just take my 3 trays, as soon as all the 3 trays are I have got this.
Professor Madhavan Mukund: Then I can proceed.
Professor G. Venkatesh: I can proceed.
Professor Madhavan Mukund: Then I can proceed.
Professor G. Venkatesh: This is really nice, producer-consumer.
Professor Madhavan Mukund: Producer-consumer. So, I think I am a little bit uneasy about this,
see we had this whole complication that we said that you had to remote procedure call, you had
polling, you had pre-emption you add all these difficulties in letting the other guy know and then
we have produced this tray and if you.
Professor G. Venkatesh: Seems.
Professor Madhavan Mukund: It size.
Professor G. Venkatesh: solved all the problems.
Professor Madhavan Mukund: I am not convinced that this has, usually you know when you
solve a problem you create something which has another problem.
Professor G. Venkatesh:
Professor Madhavan Mukund: This does not seems to create any.
Professor G. Venkatesh: See I called physics guy, physics returns the value in the physics tray,
so let us go back check my physics tray that is all.
Professor Madhavan Mukund: So, let us go back to our fast food counter. So, I ordered say for
instance I ordered some Dosa, so this guy has got to give me back a tray with Dosa in it, but the
tray with Dosa also comes with some you know some bowl of sambar and a bowl of chutney an
all that. So, he puts the Dosa on the tray, I see the Dosa and I grabbed it.
Professor G. Venkatesh: Without the chutney
Professor Madhavan Mukund: And then he is about to put the chutney and the sambar and the
tray is gone. So, this is the problem. So, while the tray is being filled while the guys is writing
the answer.
Professor G. Venkatesh: I should reading.
Professor Madhavan Mukund: I should not be reading it, because I may have see only part of the
answer it may not make sense.
Professor G. Venkatesh:
Professor Madhavan Mukund: So, like I might be writing a long number, I might only see the
first 5 digits or first 3 digits or something and I might think that is the answer.
Professor G. Venkatesh: But how do I know the guy written the thing on it.
Professor Madhavan Mukund: So, that something, because we do not have seem.
Professor G. Venkatesh: But I do not have seem those are, you know that what you will get along
in that, sometimes you do not know, something will I am lot of chutneys. We have only two
chutneys
Professor Madhavan Mukund: Different Dosa
s different restaurants have different.
Professor G. Venkatesh: Number of.
Professor Madhavan Mukund: Number of things that they will add.
Professor G. Venkatesh: So, how do I know? That guys has to say I am done.
Professor Madhavan Mukund: Somehow you have to have some idea that it is a full set, I mean
the full launch.
Professor G. Venkatesh: He has to close that, he has to close the counter not allow you to take
the tray till he has put everything on it and keep the tray on his side.
Professor Madhavan Mukund: The tray is with you.
Professor G. Venkatesh: That is the problem.
Professor Madhavan Mukund: Somebody has to do that.
Professor G. Venkatesh: Somebody has to say.
Professor Madhavan Mukund: Somebody has to tell you that this tray is not ready yet, it is
maybe what he has to do is that there is maybe baguette.
Professor G. Venkatesh: he will say.
Professor Madhavan Mukund: So, maybe there is a some button or something or some marker on
the tray.
Professor G. Venkatesh: Marker on the tray.
Professor Madhavan Mukund: Or maybe he has to put a token or something saying that this is
done. So, he first while that you may see things on the tray, but if you do not see that token.
Professor G. Venkatesh:
Professor Madhavan Mukund: So, you are not supposed to take it. So, I think we need to do
something.
Professor G. Venkatesh: So, tray, so the problem is what is problem? Problem is at the level of
the tray reading and writing one guy is reading, who is reading? The consumer.
Professor Madhavan Mukund: The consumer that is a class who asked the question is reading.
Professor G. Venkatesh: And the producer is writing, reading and writing may come, together.
Professor Madhavan Mukund: First of all they might take, they take, it is not a single step.
Professor G. Venkatesh: Because you are writing one bite or something, writing one digit.
Professor Madhavan Mukund: You could be writing some long thing which consists of smaller
part.
Professor G. Venkatesh; Smaller parts, so you write one part and then you are going to write the
second part, meanwhile the guy started reading, we it should not allow that.
Professor Madhavan Mukund: We should not allow that.
Professor G. Venkatesh: So, this business of reading and writing has to be made into one.
Professor Madhavan Mukund: That made into an all-or-nothing either he has written or he has
not written even though the writing might take some time.
Professor G. Venkatesh: Long time, because it
s remote maybe.
Professor Madhavan Mukund: It is also remote.
Professor G. Venkatesh: So, internet connection and all will take time.
Professor Madhavan Mukund: So, this happens right when we are downloading some big thing.
Professor G. Venkatesh: In the middle of the file you can try to read it.
Professor Madhavan Mukund: You cannot start watching this movie or seeing a picture until the
whole thing is come.
Professor G. Venkatesh: Sometimes.
Professor Madhavan Mukund: Sometimes. So, then this is like that. So, you are getting this
whole data from the producer but you should have a clear indication saying.
Professor G. Venkatesh: It is done.
Professor Madhavan Mukund: This is done.
Professor G. Venkatesh: So, if you make, so basically the reading and writing is atomic, when
you are not allow to break it.
Professor Madhavan Mukund: Atomic, I think that is a good word, so atomic. So, we have to
basically make sure that this is atomic.
(Refer Slide Time: 17:07)
Professor G. Venkatesh: Reading and Writing have to be atomic and you have to ensure that if
read either read comes before write or write comes before read, but both cannot be done
simultaneously.
Professor Madhavan Mukund: So, you have this write coming from here, this is our producer and
we have this read coming to here, which is our consumer. So, whenever I see a read and write
either the read must finish before the write starts, so that is supposing this producer has been
asked.
Professor G. Venkatesh: But if read come before write you will have problem in this case.
Professor Madhavan Mukund: But it is a Q. So, I am saying that supposing there is another item
here that also I would not like that guy to start writing until.
Professor G. Venkatesh: So, there is nothing in the Q and you read.
Professor Madhavan Mukund; Then you will just say there is nothing there, then you come back.
Professor G. Venkatesh; You come back again, so no problem.
Professor Madhavan Mukund: And say no problem. If there is something in the Q and you start
reading.
Professor G. Venkatesh: Then the write guy should not write.
Professor Madhavan Mukund; Write guy should not be write it, so it must be a complete unit and
they should be no confusion as to
Professor G. Venkatesh: So, either you read or write but you cannot do both, so there is no
concurrency in this, we have concurrency outside, but for as far as this one is concern the tray is
concern.
Professor Madhavan Mukund: So here there should be no
Professor G. Venkatesh: There are disallowing concurrency on the tray.
Professor Madhavan Mukund: Because otherwise you have this confusion, as to whether the
answer is available or not available.
Professor G. Venkatesh; I see.
Professor Madhavan Mukund: See because in the earlier cases we did not have this problem,
because when you pre-empted or you polled that guy will only give you the answer when he is
ready. So, you know for sure when he starts telling you the answer that the answer is fully ready
and you will be able to do that.
Professor G. Venkatesh: Now, it is not like that.
Professor Madhavan Mukund: Now, you are picking up the answer in.
Professor G. Venkatesh; In middle.
Professor Madhavan Mukund: In without coordinating with that person, in some sense you are
not talking to the producer anymore, you are just going by want a producer has left behind in the,
so it is like a delivery guy who is bringing up two.
Professor G. Venkatesh; Two things.
Professor Madhavan Mukund; Two things to your house or goes down pick up the second thing.
Professor G. Venkatesh: You took the first thing.
Professor Madhavan Mukund: And went off, so he does not know and you are wondering why
half the things did not get delivered. So, this is the problem. So, because you are not directly
talking to the producer, anymore you are not doing.
Professor G. Venkatesh: So, if you make it atomic that is that read and write are atomic
operations, so you are not allowed to break down that read into X parts or at least even if it is
broke down and into parts the entire thing as to be executed fully, before the other things
executed. So, the read is one full thing one atomic thing write is a one atomic thing and there is
no concurrency between read and write here. So, overall there is concurrency, but on this
particular trading, so this allows the concurrency.
Professor Madhavan Mukund: So, this this value has to be treated separately, treated in a very
careful way.
Professor G. Venkatesh: If you do that, then there is the problem.
Professor Madhavan Mukund; Then I think the problem go, but then somebody has to do this.
So, this is again now something which is
Professor G. Venkatesh: Since it is my object. So, I have to make somebody inside my objective.
Professor Madhavan Mukund: So, that is be somebody.
Professor G. Venkatesh: keep monitoring.
Professor Madhavan Mukund: Monitoring this kind of thing and doing.
Professor G. Venkatesh: Make sure that there is no concurrency on that, but to all the tokens of
stick the token and do all that interesting stuff make sure that sanity of the trays maintained.
Professor Madhavan Mukund: So, the trays always in some consistent state.
Professor G. Venkatesh; Consistent state. Then it will work.
Professor Madhavan Mukund; Then it will, then I agree, so then my misgivings about this thing
addressed a little bit.
